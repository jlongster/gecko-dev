<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Inspector | Firefox Developer Tools</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../docs/react-style.html" />
    
    
    <link rel="prev" href="../docs/tools.html" />
    

        <script type="text/javascript" src="../docs/static/js/bundle.js"></script><script type="text/javascript" src="../docs/static/js/globals.js"></script>
    </head>
    <body>
        
        
    <div class="book" data-level="2.1" data-chapter-title="Inspector" data-filepath="docs/inspector-panel.md" data-basepath=".." data-revision="Mon Dec 28 2015 00:43:50 GMT-0500 (EST)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="docs/index.html">
            
                
                    <a href="../docs/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="docs/tools.html">
            
                
                    <a href="../docs/tools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Tools
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1" data-path="docs/inspector-panel.html">
            
                
                    <a href="../docs/inspector-panel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Inspector
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="docs/react-style.html">
            
                
                    <a href="../docs/react-style.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        React Style Guide
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="docs/components.html">
            
                
                    <a href="../docs/components.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Components
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="client/debugger/content/components/box.html">
            
                
                    <a href="../client/debugger/content/components/box.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Box &amp; Panel
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Firefox Developer Tools</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="highlevel-inspector-architecture">High-Level Inspector Architecture</h1>
<h2 id="ui-structure">UI structure</h2>
<p>The Inspector panel is a tab in the toolbox. Like all tabs, it&apos;s in its own iframe.</p>
<p>The high-level hierarchy looks something like this:</p>
<pre><code> Toolbox
    |
InspectorPanel
    |
+-------------+------------------+---------------+
|             |                  |               |
MarkupView  SelectorSearch  HTMLBreadcrumbs  ToolSidebar widget (iframes)
                                                 |
                                                 +- RuleView
                                                 |
                                                 +- ComputedView
                                                 |
                                                 +- LayoutView
                                                 |
                                                 +- FontInspector
                                                 |
                                                 +- AnimationInspector
</code></pre><h2 id="server-dependencies">Server dependencies</h2>
<ul>
<li>The inspector panel relies on a series of actors that live on the server.</li>
<li>Some of the most important actors are actually instantiated by the toolbox, because these actors are needed for other panels to preview and link to DOM nodes. For example, the webconsole needs to output DOM nodes, highlight them in the page on mouseover, and open them in the inspector on click. This is achieved using some of the same actors that the inspector panel uses.</li>
<li>See Toolbox.prototype.initInspector: This method instantiates the InspectorActor, WalkerActor and HighlighterActor lazily, whenever they&apos;re needed by a panel.</li>
</ul>
<h2 id="panel-loading-overview">Panel loading overview</h2>
<ul>
<li>As with other panels, this starts with Toolbox.prototype.loadTool(id)</li>
<li>For the inspector though, this calls Toolbox.prototype.initInspector</li>
<li>When the panel&apos;s open method is called:<ul>
<li>It uses the WalkerActor for the first time to know the default selected node (which could be a node that was selected before on the same page).</li>
<li>It starts listening to the WalkerActor&apos;s &quot;new-root&quot; events to know when to display a new DOM tree (when there&apos;s a page navigation).</li>
<li>It creates the breadcrumbs widget, the sidebar widget, the search widget, the markup-view</li>
</ul>
</li>
<li>Sidebar:<ul>
<li>When this widget initializes, it loads its sub-iframes (rule-view, ...)</li>
<li>Each of these iframes contain panel that, in turn, listen to inspector events like &quot;new-node-front&quot; to know when to retrieve information about a node (i.e the rule-view will fetch the css rules for a node).</li>
</ul>
</li>
<li>Markup-view:<ul>
<li>This panel initializes in its iframe, and gets a reference to the WalkerActor. It uses it to know the DOM tree to display. It knows when nodes change (markup-mutations), and knows what root node to start from.</li>
<li>It only displays the nodes that are supposed to be visible at first (usually html, head, body and direct children of body).</li>
<li>Then, as you expand nodes, it uses the WalkerActor to get more nodes lazily. It only ever knows data about nodes that have already been expanded once in the UI.</li>
</ul>
</li>
</ul>
<h2 id="serverside-structure">Server-side structure</h2>
<p>Simplified actor hierarchy</p>
<pre><code>InspectorActor
     |
+---------------+
|               |
WalkerActor    PageStyleActor (for rule-view/computed-view)
|               |
NodeActor      StyleRuleActor
</code></pre><p><strong>InspectorActor</strong></p>
<p>This tab-level actor is the one the inspector-panel connects to. It doesn&apos;t do much apart from creating and returning the WalkerActor and PageStyleActor.</p>
<p><strong>WalkerActor</strong></p>
<ul>
<li>Single most important part of the inspector panel.</li>
<li>Responsible for walking the DOM on the current page but:<ul>
<li>also walks iframes</li>
<li>also finds pseudo-elements ::before and ::after</li>
<li>also finds anonymous content (e.g. in the BrowserToolbox)</li>
</ul>
</li>
<li>The actor uses an instance of inIDeepTreeWalker to walk the DOM</li>
<li>Provides a tree of NodeActor objects that reflects the DOM.</li>
<li>But only has a partial knowledge of the DOM (what is currently displayed/expanded in the MarkupView). It doesn&apos;t need to walk the whole tree when you first instantiate it.</li>
<li>Reflects some of the usual DOM APIs like querySelector.</li>
<li>Note that methods like querySelector return arbitrarily nested NodeActors, in which case the WalkerActor also sends the list of parents to link the returned nodes to the closest known nodes, so the UI can display the tree correctly.</li>
<li>Emits events when there are DOM mutations. These events are sent to the front-end and used to, for example refresh the markup-view. This uses an instance of MutationObserver (<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver</a>) configured with, in particular, nativeAnonymousChildList set to true, so that mutation events are also sent when pseudo elements are added/removed via css.</li>
</ul>
<p><strong>NodeActor</strong></p>
<ul>
<li>Representation of a single DOM node (tagname, namespace, attributes, parent, sibblings, ...), which panels use to display previews of nodes.</li>
<li>Also provide useful methods to:<ul>
<li>change attributes</li>
<li>scroll into view</li>
<li>get event listeners data</li>
<li>get image data</li>
<li>get unique css selector</li>
</ul>
</li>
</ul>
<h2 id="highlighters">Highlighters</h2>
<p>One of the important aspects of the inspector is the highlighters.
Some documentation already at: <a href="https://wiki.mozilla.org/DevTools/Highlighter" target="_blank">https://wiki.mozilla.org/DevTools/Highlighter</a></p>
<p>We don&apos;t just have 1 highlighter, we have a framework for highlighters:</p>
<ul>
<li>a (chrome-only) platform API to inject markup in a native-anonymous node in content (that works on all targets)</li>
<li>a number of specific highlighter implementations (css transform, rect, selector, geometry, rulers, ...)</li>
<li>a CustomHighlighterActor to get instances of specific highlighters</li>
</ul>
<p>The entry point is toolbox-highlighter-utils.js:</p>
<ul>
<li>get it with toolbox.highlighterUtils</li>
<li>use this to easily highlight any node in the page (with the usual box model highlighter),</li>
<li>also use this to instantiate an other specific highlighter</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../docs/tools.html" class="navigation navigation-prev " aria-label="Previous page: Tools"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../docs/react-style.html" class="navigation navigation-next " aria-label="Next page: React Style Guide"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"addcssjs":{"js":["docs/static/js/bundle.js","docs/static/js/globals.js"]},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
